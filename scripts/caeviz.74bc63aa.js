/*! 01-02-2016 9:20:00 AM */
function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}THREE.VelvetShader={vertexColors:THREE.VertexColors,uniforms:{opacity:{type:"f",value:1},ambientBrightness:{type:"f",value:.3},tint:{type:"v4",value:new THREE.Vector4(0,0,0,0)}},vertexShader:"varying vec3 fNormal;varying vec3 fPosition;varying vec3 fColor;const float lumaMin = 0.15;const float lumaRange = 1. - lumaMin;float getLumaFromColor(const in vec3 color) {return color.x * 0.299 + color.y * 0.587 + color.z * 0.114;}vec3 compressColor(vec3 color){float luma = getLumaFromColor(color);return color * lumaRange + lumaMin;}void main(){vec4 pos = modelViewMatrix * vec4(position, 1.0);fNormal = normalize(normalMatrix * normal);fColor = compressColor(color);fPosition = pos.xyz;gl_Position = projectionMatrix * pos;}",fragmentShader:"uniform float opacity;uniform float ambientBrightness;uniform float directFactor; uniform vec4 tint;varying vec3 fPosition;varying vec3 fNormal;varying vec3 fColor;void main(){ float normalDot = abs(dot(fNormal, normalize(-fPosition)));float lightAmount = mix(ambientBrightness, 1.0, normalDot);vec3 color = fColor * lightAmount;if (tint.w > 0.) {float tintAmount = mix(tint.w*0.1, tint.w, normalDot);color = mix(color, tint.xyz, tintAmount);}gl_FragColor = vec4(color, opacity);}"},THREE.Object3D.prototype.getBoundingBox=function(a){this.boundingBox||(this.boundingBox=(new THREE.Box3).setFromObject(this));var b=this.boundingBox.clone();return a&&!b.empty()&&this._transform&&b.applyMatrix4(this._transform),b},THREE.Object3D.prototype.getCentroid=function(a){void 0===a&&(a=!0);var b=this.getBoundingBox(!1);return a&&(b.min.applyMatrix4(this.matrixWorld),b.max.applyMatrix4(this.matrixWorld)),b.center()},THREE.Object3D.prototype.computeBoudingBoxSphere=function(){var a=(new THREE.Box3).setFromObject(this),b=(new THREE.Sphere).setFromPoints([a.max,a.min]);this.center_x=(a.max.x+a.min.x)/2,this.center_y=(a.max.y+a.min.y)/2,this.center_z=(a.max.z+a.min.z)/2,this.radius=b.radius},THREE.Object3D.prototype.explode=function(a){void 0===a&&(a=100),this._explodeDistance||(this._explodeDistance=0),this._explodeDistance+a<0&&(a=-this._explodeDistance),this._explodeDistance+=a;var b=this.getCentroid(!0);this.traverse(function(c){if(c instanceof THREE.Mesh){var d=b.clone();c.worldToLocal(d);var e=c.getCentroid(!1),f=(new THREE.Vector3).copy(e);f.sub(d).normalize(),c.translateOnAxis(f,a)}}),0===this._explodeDistance&&this.resetExplode()},THREE.Object3D.prototype.resetExplode=function(){this._explodeDistance&&(this.explode(-this._explodeDistance),this._explodeDistance=void 0)},THREE.CSZLoader=function(a){this.manager=void 0!==a?a:THREE.DefaultLoadingManager},THREE.CSZLoader.prototype={constructor:THREE.CSZLoader,load:function(a,b,c,d){function d(a){console.warn("Error ...",a)}var e=this;console.time("CSZLoader");var f=new THREE.XHRLoader(e.manager);f.setCrossOrigin(this.crossOrigin),f.setResponseType("arraybuffer"),f.load(a,function(a){b(e.parse(a)),console.timeEnd("CSZLoader")},c,d)},parse:function(a){var b=this,c=new JSZip,d=c.load(a),e=new THREE.Object3D,f=null;f=JSON.parse(d.files["details.json"].asText());var g=new Array;return _.each(f.parts,function(a){if(void 0!==a&&null!==a){if(g.length<=0)for(var c in a)a.hasOwnProperty(c)&&g.push(c);var f=(a.name,"PART_"+a.id);if(void 0!==d.files[f]){var h=b.getObject(d.files[f].asText());e.add(_.extend(h,a))}}}),e.attrs=g,e.name=f.name,e.solver=f.solver,_.extend(e,f),e},getObject:function(a){function b(a){var b=parseInt(a);return 3*(b>=0?b-1:b+l.length/3)}function c(a){var b=parseInt(a);return 3*(b>=0?b-1:b+m.length/3)}function d(a){var b=parseInt(a);return 2*(b>=0?b-1:b+n.length/2)}function e(a,b,c){j.vertices.push(l[a],l[a+1],l[a+2],l[b],l[b+1],l[b+2],l[c],l[c+1],l[c+2])}function f(a,b,c){j.normals.push(m[a],m[a+1],m[a+2],m[b],m[b+1],m[b+2],m[c],m[c+1],m[c+2])}function g(a,b,c){j.uvs.push(n[a],n[a+1],n[b],n[b+1],n[c],n[c+1])}function h(a,h,i,j,k,l,m,n,o,p,q,r){var s,t=b(a),u=b(h),v=b(i);void 0===j?e(t,u,v):(s=b(j),e(t,u,s),e(u,v,s)),void 0!==k&&(t=d(k),u=d(l),v=d(m),void 0===j?g(t,u,v):(s=d(n),g(t,u,s),g(u,v,s))),void 0!==o&&(t=c(o),u=c(p),v=c(q),void 0===j?f(t,u,v):(s=c(r),f(t,u,s),f(u,v,s)))}var i,j,k;/^o /gm.test(a)===!1&&(j={vertices:[],normals:[],uvs:[]},k={name:""},i={name:"",geometry:j,material:k});for(var l=[],m=[],n=[],o=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,p=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,q=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,r=/f( +-?\d+)( +-?\d+)( +-?\d+)( +-?\d+)?/,s=/f( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))?/,t=/f( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))?/,u=/f( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))?/,v=a.split("\n"),w=0;w<v.length;w++){var x=v[w];x=x.trim();var y;0!==x.length&&"#"!==x.charAt(0)&&(null!==(y=o.exec(x))?l.push(parseFloat(y[1]),parseFloat(y[2]),parseFloat(y[3])):null!==(y=p.exec(x))?m.push(parseFloat(y[1]),parseFloat(y[2]),parseFloat(y[3])):null!==(y=q.exec(x))?n.push(parseFloat(y[1]),parseFloat(y[2])):null!==(y=r.exec(x))?h(y[1],y[2],y[3],y[4]):null!==(y=s.exec(x))?h(y[2],y[5],y[8],y[11],y[3],y[6],y[9],y[12]):null!==(y=t.exec(x))?h(y[2],y[6],y[10],y[14],y[3],y[7],y[11],y[15],y[4],y[8],y[12],y[16]):null!==(y=u.exec(x))?h(y[2],y[5],y[8],y[11],void 0,void 0,void 0,void 0,y[3],y[6],y[9],y[12]):/^o /.test(x)?(j={vertices:[],normals:[],uvs:[]},k={name:""},i={name:x.substring(2).trim(),geometry:j,material:k}):/^g /.test(x)||(/^usemtl /.test(x)?k.name=x.substring(7).trim():/^mtllib /.test(x)||/^s /.test(x)))}j=i.geometry;var z=new THREE.BufferGeometry;z.addAttribute("position",new THREE.BufferAttribute(new Float32Array(j.vertices),3)),j.normals.length>0&&z.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(j.normals),3)),j.uvs.length>0&&z.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(j.uvs),2)),z.computeFaceNormals(),z.computeVertexNormals(),z.computeBoundingBox(),z.computeBoundingSphere(),k=new THREE.MeshLambertMaterial({color:15790320*Math.random(),overdraw:!0,wireframe:!1,transparent:!1,opacity:.85,side:THREE.DoubleSide});var A=new THREE.Mesh(z,k);A.getCentroid().x,A.getCentroid().y,A.getCentroid().z;return A}};var THREE=THREE||{};!function(a){var b={vertexShader:["attribute float id;","","uniform float size;","uniform float scale;","uniform float baseId;","","varying vec4 worldId;","","void main() {","  vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","  gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","  float i = baseId + id;","  vec3 a = fract(vec3(1.0/255.0, 1.0/(255.0*255.0), 1.0/(255.0*255.0*255.0)) * i);","  a -= a.xxy * vec3(0.0, 1.0/255.0, 1.0/255.0);","  worldId = vec4(a,1);","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#ifdef GL_ES\n","precision highp float;\n","#endif\n","","varying vec4 worldId;","","void main() {","  gl_FragColor = worldId;","}"].join("\n")},c=function(){a.ShaderMaterial.call(this,{uniforms:{baseId:{type:"f",value:0},size:{type:"f",value:.01},scale:{type:"f",value:400}},attributes:["position","id"],vertexShader:b.vertexShader,fragmentShader:b.fragmentShader})};c.prototype=Object.create(a.ShaderMaterial.prototype),c.prototype.constructor=c,c.prototype.setBaseID=function(a){this.uniforms.baseId.value=a},c.prototype.setPointSize=function(a){this.uniforms.size.value=a},c.prototype.setPointScale=function(a){this.uniforms.scale.value=a},function(b){a.Object3D.prototype.clone=function(a,c){return a=b.call(this,a,c),a.originalObject=this,a.priority=this.priority,a}}(a.Object3D.prototype.clone),a.Mesh.prototype.raycastWithID=function(){var b=new a.Vector3,c=new a.Vector3,d=new a.Vector3,e=new a.Matrix4,f=new a.Ray,g=new a.Triangle;return function(h,i){var j=this.geometry,k=j.attributes;e.getInverse(this.matrixWorld),f.copy(i.ray).applyMatrix4(e);var l,m,n;if(void 0!==k.index)console.log("WARNING: raycastWithID does not support indexed vertices");else{var o=k.position.array,p=9*h;b.fromArray(o,p),c.fromArray(o,p+3),d.fromArray(o,p+6)}g.set(b,c,d);var q=f.intersectPlane(g.plane());if(null===q)return void console.log("WARNING: intersectionPoint missing");q.applyMatrix4(this.matrixWorld);var r=i.ray.origin.distanceTo(q);if(!(r<i.near||r>i.far)){var s={distance:r,point:q,face:new a.Face3(l,m,n,a.Triangle.normal(b,c,d)),index:h,object:this};return s}}}(),a.Line.prototype.raycastWithID=function(){var b=new a.Matrix4,c=new a.Ray,d=new a.Vector3,e=new a.Vector3,f=new a.Vector3,g=new a.Vector3;return function(h,i){b.getInverse(this.matrixWorld),c.copy(i.ray).applyMatrix4(b);var j=this.geometry;if(j instanceof a.BufferGeometry){var k=j.attributes;if(void 0===k.index){var l=k.position.array,m=6*h;d.fromArray(l,m),e.fromArray(l,m+3);var n=(c.distanceSqToSegment(d,e,g,f),c.origin.distanceTo(g));if(n<i.near||n>i.far)return;var o={distance:n,point:f.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this};return o}console.log("WARNING: raycastWithID does not support indexed vertices")}}}(),a.PointCloud.prototype.raycastWithID=function(){var b=new a.Matrix4,c=new a.Ray;return function(d,e){var f=this,g=f.geometry;b.getInverse(this.matrixWorld),c.copy(e.ray).applyMatrix4(b);var h=new a.Vector3,i=function(a,b){var d=c.distanceToPoint(a),g=c.closestPointToPoint(a);g.applyMatrix4(f.matrixWorld);var h=e.ray.origin.distanceTo(g);if(!(h<e.near||h>e.far)){var i={distance:h,distanceToRay:d,point:g.clone(),index:b,face:null,object:f};return i}},j=g.attributes,k=j.position.array;return h.fromArray(k,3*d),i(h,d)}}(),a.GPUPicker=function(b){void 0===b&&(b={}),this.pickingScene=new a.Scene,this.pickingTexture=new a.WebGLRenderTarget,this.pickingTexture.minFilter=a.LinearFilter,this.pickingTexture.generateMipmaps=!1,this.lineShell=void 0!==b.lineShell?b.lineShell:4,this.pointShell=void 0!==b.pointShell?b.pointShell:.1,this.debug=void 0!==b.debug?b.debug:!1,this.needUpdate=!0,b.renderer&&this.setRenderer(b.renderer),this.container=[],this.objectsMap={},this.setFilter()},a.GPUPicker.prototype.setRenderer=function(a){this.renderer=a;var b=a.getSize();this.resizeTexture(b.width,b.height),this.needUpdate=!0},a.GPUPicker.prototype.resizeTexture=function(a,b){this.pickingTexture.setSize(a,b),this.pixelBuffer=new Uint8Array(4*a*b),this.needUpdate=!0},a.GPUPicker.prototype.setCamera=function(a){this.camera=a,this.needUpdate=!0},a.GPUPicker.prototype.update=function(){this.needUpdate&&(this.renderer.render(this.pickingScene,this.camera,this.pickingTexture),this.renderer.readRenderTargetPixels(this.pickingTexture,0,0,this.pickingTexture.width,this.pickingTexture.height,this.pixelBuffer),this.needUpdate=!1,this.debug&&console.log("GPUPicker rendering updated"))},a.GPUPicker.prototype.setFilter=function(a){a instanceof Function?this.filterFunc=a:this.filterFunc=function(a){return!0}},a.GPUPicker.prototype.setScene=function(a){this.pickingScene=a.clone(),this._processObject(this.pickingScene,0),this.needUpdate=!0},a.GPUPicker.prototype.pick=function(a,b){this.update();var c=a.x+(this.pickingTexture.height-a.y)*this.pickingTexture.width,d=255*this.pixelBuffer[4*c+2]*255+255*this.pixelBuffer[4*c+1]+this.pixelBuffer[4*c+0];this.debug&&console.log("pick id:",d);var e=this._getObject(this.pickingScene,0,d),f=e[1],g=d-e[0];if(f&&f.raycastWithID){var h=f.raycastWithID(g,b);return h.object=f.originalObject,h}},a.GPUPicker.prototype._getObject=function(a,b,c){if(void 0!==a.elementsCount&&c>=b&&c<b+a.elementsCount)return[b,a];void 0!==a.elementsCount&&(b+=a.elementsCount);for(var d=[b,void 0],e=0;e<a.children.length&&(d=this._getObject(a.children[e],d[0],c),void 0===d[1]);e++);return d},a.GPUPicker.prototype._processObject=function(a,b){b+=this._addElementID(a,b);for(var c=0;c<a.children.length;c++)b=this._processObject(a.children[c],b);return b},a.GPUPicker.prototype._addElementID=function(b,d){if(!this.filterFunc(b)&&void 0!==b.geometry)return b.visible=!1,0;if(b.geometry){var e;if(b.geometry.__pickingGeometry)e=b.geometry.__pickingGeometry;else{e=b.geometry,b.geometry instanceof a.Geometry&&(this.debug&&console.log("convert geometry to buffer geometry"),e=(new a.BufferGeometry).setFromObject(b));var f=1;b instanceof a.PointCloud?f=1:b instanceof a.Line?f=2:b instanceof a.Mesh&&(f=3);var g,h,i,j,k,l,m,n,o;if(void 0!==e.attributes.index){for(e=e.clone(),this.debug&&console.log("convert indexed geometry to non-indexed geometry"),k=e.attributes.index.array,n=e.attributes.position.array,delete e.attributes.position,delete e.attributes.index,delete e.attributes.normal,i=k.length/f,l=new Float32Array(3*i*f),e.addAttribute("position",new a.BufferAttribute(l,3)),g=0;i>g;++g)for(h=f*g,j=0;f>j;++j)o=3*k[h+j],m=3*(h+j),l[m]=n[o],l[m+1]=n[o+1],l[m+2]=n[o+2];e.computeVertexNormals()}if(b instanceof a.Line&&!(b instanceof a.LineSegments)){for(this.debug&&console.log("convert Line to LineSegments"),n=e.attributes.position.array,delete e.attributes.position,i=n.length/3-1,l=new Float32Array(i*f*3),e.addAttribute("position",new a.BufferAttribute(l,3)),g=0;i>g;++g)h=3*g,o=h,m=2*h,l[m]=n[o],l[m+1]=n[o+1],l[m+2]=n[o+2],l[m+3]=n[o+3],l[m+4]=n[o+4],l[m+5]=n[o+5];e.computeVertexNormals(),b.__proto__=a.LineSegments.prototype}for(var p=e.attributes,q=p.position.array,r=q.length/3,s=new a.Float32Attribute(r,1),j=0,t=r/f;t>j;j++)for(var u=0;f>u;++u)s.array[j*f+u]=j;e.addAttribute("id",s),e.elementsCount=r/f,b.geometry.__pickingGeometry=e}b.geometry=e,b.elementsCount=e.elementsCount;var v=b.material.size||.01,w=b.material.linewidth||1;return b.material=new c,b.material.side=a.DoubleSide,b.material.linewidth=w+this.lineShell,b.material.setBaseID(d),b.material.setPointSize(v+this.pointShell),b.material.setPointScale(this.renderer.getSize().height*this.renderer.getPixelRatio()/2),b.elementsCount}return 0}}(THREE),function(){function a(a){return a>=97&&122>=a}function b(a){return a.substr(0,1).toUpperCase()+a.substr(1).toLowerCase()}function c(a){return a>=112&&123>=a?"F"+(a-111):!1}function d(a){if(a>=96&&106>a)return"Num"+(a-96);switch(a){case 106:return"Num*";case 111:return"Num/";case 110:return"Num.";default:return!1}}function e(a){s.ctrl=a.ctrl,s.alt=a.alt,s.shift=a.shift}function f(a,b){return a.ctrl===b.ctrl&&a.alt===b.alt&&a.shift===b.shift}var g=["ctrl","alt","shift"],h={},i={58:59,43:61,60:44,95:45,62:46,63:47,96:192,124:92,39:222,34:222,33:49,64:50,35:51,36:52,37:53,94:54,38:55,42:56,40:57,41:58,123:91,125:93},j=(-1!=navigator.userAgent.indexOf("Gecko"),-1!=navigator.userAgent.indexOf("MSIE"),-1!=navigator.platform.indexOf("Win")),k=window.opera&&window.opera.version()<9.5,l=navigator.vendor&&-1!=navigator.vendor.indexOf("KDE"),m=navigator.vendor&&-1!=navigator.vendor.indexOf("iCab"),n={186:59,187:61,188:44,109:95,107:61,189:95,190:62,191:47,192:126,219:91,220:92,221:93},o={};if(k&&j)h=o;else if(k||l||m){var p=[33,64,35,36,37,94,38,42,40,41,58,43,60,95,62,63,124,34];h=o;for(var q=0;q<p.length;++q)h[p[q]]=i[p[q]]}else h=n;l&&(h[0]=45,h[127]=46,h[45]=95);var r={32:"SPACE",13:"ENTER",9:"TAB",8:"BACKSPACE",16:"SHIFT",17:"CTRL",18:"ALT",20:"CAPS_LOCK",144:"NUM_LOCK",145:"SCROLL_LOCK",37:"LEFT",38:"UP",39:"RIGHT",40:"DOWN",33:"PAGE_UP",34:"PAGE_DOWN",36:"HOME",35:"END",45:"INSERT",46:"DELETE",27:"ESCAPE",19:"PAUSE",222:"'"},s={codes:{},ctrl:!1,alt:!1,shift:!1};if("undefined"!=typeof window.KeyCode)var t=window.KeyCode;var u=window.KeyCode={no_conflict:function(){return window.KeyCode=t,u},fkey:function(a){return 111+a},numkey:function(a){switch(a){case"*":return 106;case"/":return 111;case".":return 110;default:return 96+a}},key:function(b){var c=b.charCodeAt(0);return a(c)?c-32:i[c]||c},key_equals:function(a,b){return a.code==b.code&&f(a,b)},translate_key_code:function(a){return h[a]||a},translate_event:function(a){a=a||window.event;var b=a.which||a.keyCode;return{code:u.translate_key_code(b),shift:a.shiftKey,alt:a.altKey,ctrl:a.ctrlKey}},key_down:function(a){var b=u.translate_event(a);s.codes[b.code]=b.code,e(b)},key_up:function(a){var b=u.translate_event(a);delete s.codes[b.code],e(b)},is_down:function(a){var b=a.code;return b==u.CTRL?s.ctrl:b==u.ALT?s.alt:b==u.SHIFT?s.shift:void 0!==s.codes[b]&&f(a,s)},hot_key:function(a){for(var e=[],f=0;f<g.length;++f){var h=g[f];a[h]&&h.toUpperCase()!=r[a.code]&&e.push(b(h))}var i=a.code,j=r[i]||c(i)||d(i)||String.fromCharCode(i);return e.push(b(j)),e.join("+")}};for(var v in r)u[r[v]]=v}();var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),Compass=function(){function a(b,c,d){if(_classCallCheck(this,a),void 0===b)return void console.log("Error > parentNode is null / undefined ");var e='<div id="compass-cube" class="cube">    <div class="cube-face cube-face-front">        <span class="cube-face-label">Front</span>        <div class="cube-button cube-face-button" data-x="0" data-y="0" data-z="0"></div>        <div class="cube-face-edge cube-face-edge-top cube-button cube-button-face-edge" data-group="front-top" data-x="45" data-y="0" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-right cube-button cube-button-face-edge" data-group="front-right" data-x="0" data-y="45" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-bottom cube-button cube-button-face-edge" data-group="front-bottom" data-x="-45" data-y="0" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-left cube-button cube-button-face-edge" data-group="front-left" data-x="0" data-y="-45" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-top-right cube-button cube-button-face-corner" data-group="front-top-right" data-x="45" data-y="45" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-bottom-right cube-button cube-button-face-corner" data-group="front-bottom-right" data-x="-45" data-y="45" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-bottom-left cube-button cube-button-face-corner" data-group="front-bottom-left" data-x="-45" data-y="-45" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-top-left cube-button cube-button-face-corner" data-group="front-top-left" data-x="45" data-y="-45" data-z="0" data-order="YXZ"></div>    </div>    <div class="cube-face cube-face-back">        <span class="cube-face-label">Back</span>        <div class="cube-button cube-face-button" data-x="0" data-y="180" data-z="0"></div>        <div class="cube-face-edge cube-face-edge-top cube-button cube-button-face-edge" data-group="back-top" data-x="45" data-y="180" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-right cube-button cube-button-face-edge" data-group="back-left" data-x="0" data-y="225" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-bottom cube-button cube-button-face-edge" data-group="back-bottom" data-x="-45" data-y="180" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-left cube-button cube-button-face-edge" data-group="back-right" data-x="0" data-y="135" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-top-right cube-button cube-button-face-corner" data-group="back-top-left" data-x="45" data-y="225" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-bottom-right cube-button cube-button-face-corner" data-group="back-bottom-left" data-x="-45" data-y="225" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-bottom-left cube-button cube-button-face-corner" data-group="back-bottom-right" data-x="-45" data-y="135" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-top-left cube-button cube-button-face-corner" data-group="back-top-right" data-x="45" data-y="135" data-z="0" data-order="YXZ"></div>    </div>    <div class="cube-face cube-face-right">        <span class="cube-face-label">Right</span>        <div class="cube-button cube-face-button" data-x="0" data-y="90" data-z="0"></div>        <div class="cube-face-edge cube-face-edge-top cube-button cube-button-face-edge" data-group="top-right" data-x="45" data-y="90" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-right cube-button cube-button-face-edge" data-group="back-right" data-x="0" data-y="135" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-bottom cube-button cube-button-face-edge" data-group="bottom-right" data-x="-45" data-y="90" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-left cube-button cube-button-face-edge" data-group="front-right" data-x="0" data-y="45" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-top-right cube-button cube-button-face-corner" data-group="back-top-right" data-x="45" data-y="135" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-bottom-right cube-button cube-button-face-corner" data-group="back-bottom-right" data-x="-45" data-y="135" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-bottom-left cube-button cube-button-face-corner" data-group="front-bottom-right" data-x="-45" data-y="45" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-top-left cube-button cube-button-face-corner" data-group="front-top-right" data-x="45" data-y="45" data-z="0" data-order="YXZ"></div>    </div>    <div class="cube-face cube-face-left">        <span class="cube-face-label">Left</span>        <div class="cube-button cube-face-button" data-x="0" data-y="-90" data-z="0"></div>        <div class="cube-face-edge cube-face-edge-top cube-button cube-button-face-edge" data-group="top-left" data-x="45" data-y="-90" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-right cube-button cube-button-face-edge" data-group="front-left" data-x="0" data-y="-45" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-bottom cube-button cube-button-face-edge" data-group="bottom-left" data-x="-45" data-y="-90" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-left cube-button cube-button-face-edge" data-group="back-left" data-x="0" data-y="-135" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-top-right cube-button cube-button-face-corner" data-group="front-top-left" data-x="45" data-y="-45" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-bottom-right cube-button cube-button-face-corner" data-group="front-bottom-left" data-x="-45" data-y="-45" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-bottom-left cube-button cube-button-face-corner" data-group="back-bottom-left" data-x="-45" data-y="-135" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-top-left cube-button cube-button-face-corner" data-group="back-top-left" data-x="45" data-y="-135" data-z="0" data-order="YXZ"></div>    </div>    <div class="cube-face cube-face-top">        <span class="cube-face-label">Top</span>        <div class="cube-button cube-face-button" data-x="90" data-y="0" data-z="0" data-up="0,0,1"></div>        <div class="cube-face-edge cube-face-edge-top cube-button cube-button-face-edge" data-group="back-top" data-x="45" data-y="180" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-right cube-button cube-button-face-edge" data-group="top-right" data-x="45" data-y="90" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-bottom cube-button cube-button-face-edge" data-group="front-top" data-x="45" data-y="0" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-left cube-button cube-button-face-edge" data-group="top-left" data-x="45" data-y="-90" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-top-right cube-button cube-button-face-corner" data-group="back-top-right" data-x="45" data-y="135" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-bottom-right cube-button cube-button-face-corner" data-group="front-top-right" data-x="45" data-y="45" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-bottom-left cube-button cube-button-face-corner" data-group="front-top-left" data-x="45" data-y="-45" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-top-left cube-button cube-button-face-corner" data-group="back-top-left" data-x="45" data-y="-135" data-z="0" data-order="YXZ"></div>    </div>    <div class="cube-face cube-face-bottom">        <span class="cube-face-label">Bottom</span>        <div class="cube-button cube-face-button" data-x="-90" data-y="0" data-z="0" data-up="0,0,-1"></div>        <div class="cube-face-edge cube-face-edge-top cube-button cube-button-face-edge" data-group="front-bottom" data-x="-45" data-y="0" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-right cube-button cube-button-face-edge" data-group="bottom-right" data-x="-45" data-y="90" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-bottom cube-button cube-button-face-edge" data-group="back-bottom" data-x="-45" data-y="180" data-z="0" data-order="YXZ"></div>        <div class="cube-face-edge cube-face-edge-left cube-button cube-button-face-edge" data-group="bottom-left" data-x="-45" data-y="-90" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-top-right cube-button cube-button-face-corner" data-group="front-bottom-right" data-x="-45" data-y="45" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-bottom-right cube-button cube-button-face-corner" data-group="back-bottom-right" data-x="-45" data-y="135" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-bottom-left cube-button cube-button-face-corner" data-group="back-bottom-left" data-x="-45" data-y="-135" data-z="0" data-order="YXZ"></div>        <div class="cube-face-corner cube-face-corner-top-left cube-button cube-button-face-corner" data-group="front-bottom-left" data-x="-45" data-y="-45" data-z="0" data-order="YXZ"></div>    </div></div>';this.controls=d,this.camera=c,this.parentNode=$(b),this.parentNode.append(e),this.$cubeButtons=$(".cube-button",this.parentNode),this.compassCube=this.parentNode.find("#compass-cube")[0],this.compassCubeMatrix=new THREE.Matrix4,this.compassCube.style.top="48px",this.compassCube.style.right="48px",this.compassCube.style.position="absolute",this.bindEvents()}return _createClass(a,[{key:"bindEvents",value:function(){var a=new THREE.Vector3(0,1,0),b=this;this.$cubeButtons.on("mouseenter",function(a){b.$cubeButtons.removeClass("hover").filter('[data-group="'+$(this).attr("data-group")+'"]').addClass("hover")}).on("mouseleave",function(a){b.$cubeButtons.removeClass("hover")}).on("click",function(c){var d,e,f;"undefined"!=typeof this.dataset.up?(e=this.dataset.up.split(",").map(parseFloat),d=new THREE.Vector3(e[0],e[1],e[2])):d=a,f="undefined"==typeof this.dataset.order?"XYZ":this.dataset.order;var g=Math.PI/180,h=new THREE.Euler(parseFloat(this.dataset.x)*g,parseFloat(this.dataset.y)*g,parseFloat(this.dataset.z)*g,f);b.controls.setRotationFromEuler(b.camera,h,d)})}},{key:"destroy",value:function(){var a=this;a.compassCube.remove()}},{key:"update",value:function(){var a,b=this.camera.up,c=this.camera.position,d=this.controls.target,e=new THREE.Matrix4;e.lookAt(d,c,b),this.compassCubeMatrix.getInverse(e),a=Array.prototype.map.call(this.compassCubeMatrix.elements,function(a){return a.toFixed(3)}),this.setStyleTransform(this.compassCube,"perspective(300px) matrix3d("+a.join()+")")}},{key:"setStyleTransform",value:function(a,b){var c,d=a.style,e=["transform","webkitTransform","MozTransform"];for(c=0;c<e.length;++c)"undefined"!=typeof d[e[c]]&&(d[e[c]]=b)}}]),a}(),ng3jswidget=function(){function a(b,c,d,e,f,g){_classCallCheck(this,a),this.height=Math.floor(d),this.width=Math.floor(c),this.domNode=b,this.dataUrl=f,this.dataType=e,this.dataName=g||null,this._dataAttrs=new Array,this._renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0}),this._camera=null,this._scene=new THREE.Scene,this._sceneCenter=new THREE.Vector3(0,0,0),this._sceneRadius=1e4,this._gpuPickdebug=!1,this._controls=null,this._model=null,this._mouse=new THREE.Vector2,this._timer=new THREE.Clock,this._effect=null,this._raycaster=new THREE.Raycaster,this._compass=null,this._isNavigate=!1,this._cRender=!1,this._sRender=!1,this._eRender=!1}return _createClass(a,[{key:"generateUUID",value:function(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b}},{key:"startup",value:function(){this._id=this.generateUUID(),this._camera=new THREE.PerspectiveCamera(45,this.width/this.height,1,1e4),this.domNode.appendChild(this._renderer.domElement),this.domNode.id=this._id,this._controls=new THREE.TrackballControls(this._camera,this._renderer.domElement),this._controls.rotateSpeed=1.5,this._controls.zoomSpeed=1.2,this._controls.panSpeed=.8,this._controls.staticMoving=!0,this._controls.dynamicDampingFactor=.3,this._scene.add(new THREE.AmbientLight(1052720));var a=new THREE.DirectionalLight(16777215,.75);a.position.set(1,1,1).normalize(),this._scene.add(a);var b=new THREE.DirectionalLight(16777215,.75);b.position.set(-1,-1,-1).normalize(),this._scene.add(b);var c=new THREE.CylinderGeometry(0,.8,5);c.applyMatrix((new THREE.Matrix4).makeTranslation(0,-2.5,0)),c.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),this._renderer.domElement.style.background="linear-gradient(to bottom, #cedbe9 0%,#26558b 100%)",this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(this.width,this.height),this._renderer.sortObjects=!1,this._isNavigate&&(this._compass=new Compass(this.domNode,this._camera,this._controls)),this.render(),this.handleEvents(),console.log("Renderer Startup ...")}},{key:"_sceneloop",value:function(a){void 0===a&&(a=!1),(this._cRender===!0||this._sRender===!0||a===!0)&&(this._sRender=!1,this._controls.update(),this._isNavigate&&this._compass.update(),this._gpuPickdebug,this._effect&&this._eRender?this._effect.render(this._scene,this._camera):this._renderer.render(this._scene,this._camera))}},{key:"resize",value:function(a,b){this.width=Math.floor(a),this.height=Math.floor(b),this._camera.aspect=this.width/this.height,this._camera.updateProjectionMatrix(),this._renderer.setSize(this.width,this.height),this._effect&&this._effect.setSize(a,b),this.invalidate()}},{key:"render",value:function(){var a=new THREE.CSZLoader,b=this;a.load(this.dataUrl,function(a){if(a.attrs&&(b.dataAttrs=a.attrs),a.computeBoudingBoxSphere(),a.radius/1e3>1){var c=1e4;a.scale.x=a.radius/c,a.scale.y=a.radius/c,a.scale.z=a.radius/c}a.computeBoudingBoxSphere(),b.add3DObject(a)})}},{key:"add3DObject",value:function(a){this._model=a,(void 0!==this._model||null!==this._model)&&(this._scene.add(this._model),this.centerCamera(this._model),this.invalidate())}},{key:"zoomToFit",value:function(){var a=this._model,b=this._model.getBoundingBox(),c=.5*b.size().length(),d=2*Math.atan(THREE.Math.degToRad(.5*this._camera.fov)*this._camera.aspect),e=Math.min(THREE.Math.degToRad(this._camera.fov),d),f=c/Math.sin(.5*e),g=b.max.clone().lerp(b.min,.5).applyMatrix4(a.matrixWorld);
this._camera.position.sub(this._controls.target).setLength(f).add(g),this._controls.target.copy(g),this.invalidate()}},{key:"setSelection",value:function(a,b){void 0===a&&console.log("Are you fucking INSANE to ask for selecting the WHOLE MODEL , Fuck off you Asshole..."),void 0===b&&(b=!1),(void 0===a.isSelected||null===a.isSelected)&&(a.isSelected=!1),a.material.transparent&&this.setTransparent(a,!1),a instanceof THREE.Mesh&&(b===!0&&a.isSelected===!1&&(a.material.color.orgHex=a.material.color.getHex(),a.material.color.setHex(16776960),a.isSelected=!0),b===!1&&a.isSelected===!0&&(a.material.color.setHex(a.material.color.orgHex),a.material.color.orgHex=void 0,a.isSelected=!1),this.invalidate())}},{key:"showSelected",value:function(a,b){var c=this;this._model.traverse(function(a){a instanceof THREE.Mesh&&(a.isSelected&&16711680===a.material.color.getHex()&&a.material.color.setHex(16776960),a.isSelected||c.setTransparent(a))})}},{key:"getSelectedObjs",value:function(){var a=this,b=new Array;return null===a._model||void 0===a._model?[]:(a._model.traverse(function(c){if(c instanceof THREE.Mesh&&c.isSelected){var d={};_.each(a.dataAttrs,function(b){d[b]=c[b],d.format=a._model.solver,d.model=a.dataName||a._model.name}),b.push(d)}}),b)}},{key:"setTransparent",value:function(a,b){void 0===b&&(b=!0),void 0===a&&this._model.traverse(function(a){a instanceof THREE.Mesh&&(a.material.opacity=b?.1:.85,a.material.transparent=b)}),a instanceof THREE.Mesh&&(a.material.opacity=b?.1:.85,a.material.transparent=b),this.invalidate()}},{key:"toggleTransparent",value:function(a){if(void 0===a){if(this._model.isTransparent===!1)return;this._model.traverse(function(a){a instanceof THREE.Mesh&&(a.material.opacity=.85,a.material.transparent=!1)}),this._model.computeBoudingBoxSphere(),this._model.isTransparent=!1}if(a instanceof THREE.Mesh){var b=!1;this._model.traverse(function(c){c instanceof THREE.Mesh&&(a.name===c.name?(c.material.opacity=.85,c.material.transparent=!1,c.isSelected&&c.material.color.setHex(16711680)):(void 0===c.isSelected||c.isSelected===!1)&&(c.material.opacity=.1,c.material.transparent=!0,b=!0))}),this._model.isTransparent=b,a.computeBoudingBoxSphere(),this.centerCamera(a)}this.invalidate()}},{key:"centerCamera",value:function(a){if(a instanceof THREE.Object3D){this._controls.reset(),this._camera.position.x=a.center_x,this._camera.position.y=a.center_y,this._camera.position.z=a.center_z;var b=(Math.sqrt(a.center_x*a.center_x+a.center_y*a.center_y+a.center_z*a.center_z),a.radius/Math.sin(this._camera.fov/2*(Math.PI/180)));this._camera.position.z=+b,this._camera.far<this._camera.position.z&&(this._camera.far=1.2*this._camera.position.z,this._camera.updateProjectionMatrix()),this._controls.target.x=a.center_x,this._controls.target.y=a.center_y,this._controls.target.z=a.center_z}else this._camera.position.y=-70,this._camera.position.z=70,this._camera.position.x=0;this.invalidate()}},{key:"invalidate",value:function(){this._sRender=!0}},{key:"updateSceneBoundingBox",value:function(a){this.sceneCenter(a.center()),this._sceneRadius=a.size().length()/2}},{key:"destroy",value:function(){var a=this;a._scene.traverse(function(b){b instanceof THREE.Mesh&&a._scene.remove(b)}),delete a._model,a._scene=null,this._renderer.forceContextLoss(),this._renderer.context=null,this._isNavigate&&this._compass.destroy(),this._renderer.domElement.remove(),this._renderer=null}},{key:"handleEvents",value:function(){var a=this,b=function(){a._cRender=!0},c=function(){a.invalidate(),a._cRender=!1},d=function(){a.invalidate()},e=function(a){a.preventDefault()},f=function(b){b.preventDefault(),a._mouse.x=b.clientX,a._mouse.y=b.clientY,a._renderer.domElement.addEventListener("mouseup",i,!1)},g=function j(b){if(a._keyCode=b.keyCode,b.keyCode===a._keyCode){switch(b.keyCode){case KeyCode.key("x"):b.shiftKey?a._model.explode(-100):a._model.explode(100),b.ctrlKey&&a._model.resetExplode(),a.invalidate();break;case KeyCode.key("i"):if(b.ctrlKey){var c=0;a._model.traverse(function(b){if(b instanceof THREE.Mesh){c+=1,console.log(b.position.x,b.position.y,b.position.z);var d=(.8*b.getCentroid().x,.8*b.getCentroid().y,.8*b.getCentroid().z,new THREE.MeshLambertMaterial({color:c%50!=0?527103:c%100!=0?589578:16713738,shading:THREE.FlatShading,overdraw:!0,wireframe:!1,transparent:!1,opacity:c%50!=0?.5:1})),e=c%50!=0?4:8,f=new THREE.Mesh(new THREE.SphereBufferGeometry(e,16,16),d);f.position.x=b.getCentroid().x,f.position.y=b.getCentroid().y,f.position.z=b.getCentroid().z,a._scene.add(f);var g=new THREE.Geometry;g.vertices.push(new THREE.Vector3(a._model.center_x,a._model.center_y,a._model.center_z)),g.vertices.push(new THREE.Vector3(b.getCentroid().x,b.getCentroid().y,b.getCentroid().z));var h=new THREE.LineBasicMaterial({color:5921370});new THREE.Line(g,h)}}),a.invalidate()}break;case KeyCode.key("p"):b.ctrlKey&&(a._eRender=!a._eRender,!a._effect&&a._eRender?(a._effect=new THREE.AnaglyphEffect(a._renderer),a._effect.setSize(a.width,a.height)):a._effect=void 0,a.invalidate());break;case KeyCode.key("v"):b.ctrlKey&&(a._eRender=!a._eRender,!a._effect&&a._eRender?(a._effect=new THREE.StereoEffect(a._renderer),a._effect.eyeSeparation=1,a._effect.setSize(a.width,a.height)):(a._effect.setSize(a.width,a.height),a._effect=void 0),a.invalidate());case KeyCode.key("f"):a._model&&(a._model.computeBoudingBoxSphere(),a.centerCamera(a._model))}document.removeEventListener("keyup",j)}},h=function(b){a._keyCode=b.keyCode,document.addEventListener("keyup",g)},i=function k(b){if(b.preventDefault(),1===b.which){var c=new THREE.Vector2;if(c.x=b.clientX,c.y=b.clientY,0==a._mouse.distanceTo(c)){var d=a._renderer.domElement.getBoundingClientRect(),e=(a._mouse.x-d.left)/d.width,f=(a._mouse.y-d.top)/d.height,g=new THREE.Vector2;g.set(2*e-1,-(2*f)+1),a._raycaster.setFromCamera(g,a._camera);var h=a._raycaster.intersectObject(a._scene,!0)[0];h&&(b.shiftKey?a.setSelection(h.object,!1):a.setSelection(h.object,!0))}a._renderer.domElement.removeEventListener("mouseup",k,!1)}};this._controls.addEventListener("end",c),this._controls.addEventListener("start",b),this._controls.addEventListener("change",d),this._renderer.domElement.addEventListener("mousedown",f),this._renderer.domElement.addEventListener("mousemove",e),this._renderer.onkeydown=h,document.addEventListener("keydown",h)}}]),a}();